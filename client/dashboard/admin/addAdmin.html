<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>List Tutor | EduPlus</title>
    <link rel="stylesheet" href="../../assets/css/pages/_verifTrans.css" />

    <!-- jsPDF dan html2canvas CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>

    </style>
</head>

<body>

    <div class="sidebar">
        <div class="logo-container">
            <span class="logo-text">EduPlus</span>
        </div>

        <a href="homeAdmin.html" class="menu-item">
            <div class="menu-icon">üè†</div>
            <span>Dashboard</span>
        </a>

        <a href="verify_trans.html" class="menu-item">
            <div class="menu-icon">üí≥</div>
            <span>Verifikasi Transaksi</span>
        </a>

        <a href="list_tutor.html" class="menu-item">
            <div class="menu-icon">üë®‚Äçüè´</div>
            <span>List Tutor</span>
        </a>

        <a href="list_transaksi.html" class="menu-item">
            <div class="menu-icon">üë®</div>
            <span>List Transaksi</span>
        </a>

        <a href="addAdmin.html" class="menu-item">
            <div class="menu-icon">‚ù§</div>
            <span>Add Admin</span>
        </a>

        <a href="settings/profile.html" class="menu-item">
            <div class="menu-icon">‚öôÔ∏è</div>
            <span>Pengaturan</span>
        </a>
    </div>

    <div class="main-content">
        <div class="header">
            <div class="welcome-text">
                <h1>Add Admin</h1>
            </div>

            <img src="http://localhost:3000/uploads/defaultPic.png" alt="Profile" class="profile-pic"
                id="profile-picture" />
            <span class="profile-name" id="profile-name">John Doe</span>

            <div class="profile-dropdown">
                <a href="settings/profile.html">
                    <i class="fas fa-user"></i> Profil Saya
                </a>
                <a href="../../auth/login/indexLogin.html"
                    onclick="localStorage.removeItem('token'); localStorage.removeItem('user');">
                    <i class="fas fa-sign-out-alt"></i> Keluar
                </a>
            </div>
        </div>


        <form id="addAdminForm" class="admin-form">
            <label>Nama Depan</label>
            <input type="text" name="firstName" required />

            <label>Nama Belakang</label>
            <input type="text" name="lastName" required />

            <label>Email</label>
            <input type="email" name="email" required />

            <label>Password</label>
            <input type="password" name="password" required />

            <label>No HP</label>
            <input type="text" name="phone_number" />

            <button type="submit">Tambah Admin</button>
        </form>

        <div id="successMessage" style="display:none; color:green;">Admin berhasil ditambahkan!</div>
        <div id="errorMessage" style="display:none; color:red;">Terjadi kesalahan saat menambahkan admin.</div>

        <style>
            .admin-form {
                display: flex;
                flex-direction: column;
                gap: 12px;
                width: 300px;
                margin-top: 2rem;
            }

            .admin-form input,
            .admin-form button {
                padding: 8px;
                font-size: 1rem;
            }
        </style>

        <script>
            document.getElementById("addAdminForm").addEventListener("submit", async function (e) {
                e.preventDefault();

                const form = e.target;
                const data = {
                    firstName: form.firstName.value,
                    lastName: form.lastName.value,
                    email: form.email.value,
                    password: form.password.value,
                    phone_number: form.phone_number.value,
                };

                try {
                    const response = await fetch("http://localhost:3000/api/admin/addAdmin", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${localStorage.getItem("token")}`,
                        },
                        body: JSON.stringify(data),
                    });

                    if (!response.ok) throw new Error();

                    document.getElementById("successMessage").style.display = "block";
                    document.getElementById("errorMessage").style.display = "none";
                    form.reset();
                } catch {
                    document.getElementById("successMessage").style.display = "none";
                    document.getElementById("errorMessage").style.display = "block";
                }
            });
        </script>

        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
        </div>
    </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            loadUserData()
        });

        async function loadUserData() {
            try {
                const res = await fetch("http://localhost:3000/api/auth/profile", {
                    headers: {
                        Authorization: `Bearer ${localStorage.getItem("token")}`,
                    },
                });
                if (!res.ok) throw new Error("401");

                const user = await res.json();
                renderUserData(user);
            } catch (err) {
                console.error(err);
                window.location.href = "/auth/login/indexLogin.html";
            }
        }

        function renderUserData(user) {
            const name = `${user.user.firstName} ${user.user.lastName}`;
            const photo = user.user.photo_path;

            document.getElementById("profile-name").textContent = name;
            if (photo) {
                document.getElementById("profile-picture").src = `http://localhost:3000${photo}`;
            }
        }
    </script>

</body>

</html>